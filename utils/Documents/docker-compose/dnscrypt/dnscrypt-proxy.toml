##############################################
#        dnscrypt-proxy configuration       #
##############################################

## This is a minimal working configuration for Docker
## Based on the official example from DNSCrypt project

###############################################################################
#                             Global settings                                  #
###############################################################################

## List of servers to use - leave commented to auto-select fastest servers
## Or uncomment and specify your preferred servers:
server_names = ['cloudflare', 'google']

## Listen addresses - IMPORTANT: must be 0.0.0.0 for Docker
listen_addresses = ['0.0.0.0:53']

## Maximum number of simultaneous client connections to accept
max_clients = 250

###############################################################################
#                            Server Selection                                  #
###############################################################################

## Use servers reachable over IPv4
ipv4_servers = true

## Use servers reachable over IPv6
ipv6_servers = false

## Use servers implementing the DNSCrypt protocol
dnscrypt_servers = true

## Use servers implementing the DNS-over-HTTPS protocol
doh_servers = true

## Server must not log user queries (declarative)
require_nolog = true

## Server must not enforce its own blocklist
require_nofilter = true

###############################################################################
#                           Connection Settings                                #
###############################################################################

## Always use TCP to connect to upstream servers
force_tcp = false

## How long a DNS query will wait for a response, in milliseconds
timeout = 5000

## Keepalive for HTTP (HTTPS, HTTP/2, HTTP/3) queries, in seconds
keepalive = 30

###############################################################################
#                                Logging                                       #
###############################################################################

## Log level (0-6, default: 2 - 0 is very verbose, 6 only contains fatal errors)
log_level = 2

###############################################################################
#                            Startup & Network                                 #
###############################################################################

## Bootstrap resolvers - used only during initial startup
bootstrap_resolvers = ['9.9.9.11:53', '8.8.8.8:53']

## Ignore system DNS settings
ignore_system_dns = true

## Maximum time (in seconds) to wait for network connectivity
netprobe_timeout = 60

## Address to check for network connectivity
netprobe_address = '9.9.9.9:53'

###############################################################################
#                                 Filters                                      #
###############################################################################

## Immediately respond to IPv6-related queries with an empty response
block_ipv6 = false

## Block unqualified domain names
block_unqualified = true

## Block queries for local zones
block_undelegated = true

## TTL for synthetic responses when request has been blocked
reject_ttl = 10

###############################################################################
#                                DNS Cache                                     #
###############################################################################

## Enable a DNS cache to reduce latency and outgoing traffic
cache = true

## Cache size
cache_size = 4096

## Minimum TTL for cached entries
cache_min_ttl = 2400

## Maximum TTL for cached entries
cache_max_ttl = 86400

## Minimum TTL for negatively cached entries
cache_neg_min_ttl = 60

## Maximum TTL for negatively cached entries
cache_neg_max_ttl = 600

###############################################################################
#                                Servers                                       #
###############################################################################

[sources]

## Main list of public DNS servers
[sources.public-resolvers]
urls = ['https://raw.githubusercontent.com/DNSCrypt/dnscrypt-resolvers/master/v3/public-resolvers.md', 'https://download.dnscrypt.info/resolvers-list/v3/public-resolvers.md']
cache_file = 'public-resolvers.md'
minisign_key = 'RWQf6LRCGA9i53mlYecO4IzT51TGPpvWucNSCh1CBM0QTaLn73Y7GFO3'
refresh_delay = 72
prefix = ''

## Anonymized DNS relays
[sources.relays]
urls = ['https://raw.githubusercontent.com/DNSCrypt/dnscrypt-resolvers/master/v3/relays.md', 'https://download.dnscrypt.info/resolvers-list/v3/relays.md']
cache_file = 'relays.md'
minisign_key = 'RWQf6LRCGA9i53mlYecO4IzT51TGPpvWucNSCh1CBM0QTaLn73Y7GFO3'
refresh_delay = 72
prefix = ''
