services:
  adguardhome:
    image: adguard/adguardhome:latest
    container_name: adguardhome
    restart: unless-stopped

    # Network mode host is recommended for proper DNS functionality
    # This allows AdGuard Home to handle DNS requests on port 53
    network_mode: host

    volumes:
      # Persist AdGuard Home work directory (config, data, etc.)
      - $HOME/adguardhome/work:/opt/adguardhome/work
      # Persist AdGuard Home config directory
      - $HOME/adguardhome/conf:/opt/adguardhome/conf

    # If you prefer not to use host network mode, uncomment ports below
    # and comment out "network_mode: host" above
    # ports:
    #   - "53:53/tcp"      # DNS over TCP
    #   - "53:53/udp"      # DNS over UDP
    #   - "67:67/udp"      # DHCP server (optional)
    #   - "68:68/udp"      # DHCP server (optional)
    #   - "80:80/tcp"      # Web interface (HTTP)
    #   - "443:443/tcp"    # Web interface (HTTPS)
    #   - "443:443/udp"    # DNS-over-QUIC
    #   - "3000:3000/tcp"  # Initial setup interface
    #   - "853:853/tcp"    # DNS-over-TLS
    #   - "784:784/udp"    # DNS-over-QUIC (legacy)
    #   - "853:853/udp"    # DNS-over-QUIC
    #   - "8853:8853/udp"  # DNS-over-QUIC
    #   - "5443:5443/tcp"  # DNSCrypt
    #   - "5443:5443/udp"  # DNSCrypt

    # Optional: Set timezone
    environment:
      - TZ=UTC

    # Optional: Set capabilities for binding to privileged ports
    # Needed if not using host network mode and binding to port 53
    # cap_add:
    #   - NET_ADMIN
    #   - NET_BIND_SERVICE
